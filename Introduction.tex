\section{Introduction}
 Supercomputing has been widely adopted in different fields for high-performance, such as artificial intelligence, and big data processing. Recently, most supercomputing is going cloud for effiecncy and elasticity, especially in hybird virtual environment, which includes both virtual machines and containers, such as AWS HPC Cloud~\cite{aws-hpc}. 

As the popular network in supercomputing, RDMA has high throughput, low latency and low CPU load. To expolit RDMA's high-performance in hybrid virtual environment, it is the first goal to be unified for RDMA virtualization. Also, the manageability and performance are important. Howerver, neither of existing solutions suits for hybrid virtual environment for all above goals.

Exsiting solutions are mainly hardware-based or software-based. The representative hardware-based virtualization is SR-IOV~\cite{sr-iov}. SR-IOV lacks scabality and portability without software virtual layer. In software virtualization, existing solutions are not adopted to hybrid virtual environment. FreeFlow is only designed for containers and ineffective due to the overhead of data commands forwarding.  HyV~\cite{pfefferle2015hybrid} ~\cite{pfefferle2014vverbs} and MasQ~\cite{he2020masq} are proposed for virtual machines.

To address these problems, we proposes an unified RDMA virtualization framework for hybrid virtual environment, which is adopted to hybrid virtual environment with high performance and high manageability. It is mainly consisted of multiple vRNICs which are managed in single virtual layer. Each vRNIC locates in userspace for flexbile management and its driver is unified for containers and VMs.

% vRNIC 
As the basic unit of our virtual RDMA, vRNIC is virtualized and provided to RDMA applications. Each vRNIC is virtualized with complete arttributes like physical RNIC, such as QP(Queue Pair) and DB(DoorBell registers) and all vRNICs are in userspace for high manageability. To utilize the high-performance of physical RNIC, vRNICs are mapped to the VF(the hardware-based virtual function) in RNIC respectively. 

% vRNIC driver
The driver of vRNIC is unified so that applications can use vRNICs transparently in both containers and VMs. To achieve it, we add a specific kernel driver in guest OS and use the same communication protocal as containers. However, we found that the performance is a critial problem even though the vRNIC is mapped to VF. So, we map the virtual RDMA resources between the vRNIC and application. After that, the zero-copy and by-pass are realized like native RDMA.

% virtual layer
To manage all vRNICs centralizly, we design a virtual layer in userspace. It is responsible for vRNIC instance virtualization and vRNIC's mapping. Especially, under the limited VFs, we makes dynamic vRNIC mapping management in virtual layer to get higher scalability. Besides, the virtual layer is software virtual switch for virtual RDMA network management, such as vRNIC address, routing rules.

Finnaly, we implement the prototype and evaluate it in different benchmarks, such as throughput, latency, scalability, and real-word applications. From the result, uniRDMA's performance is close to native RDMA in hybrid virtual environment and the overhead is less than 5\% to hardware-based virtualization. uniRDMA also has high scalability and adapts to real-world RDMA applications in hybrid cloud environments.The main contributions in this paper are as follows:

\begin{itemize}
\item Unified RDMA virtulization in hybrid virtual environments is firstly proposed in this paper and uniRDMA is general RDMA virtualization framework,  while maintaining high performance and high manageability.

\item uniRDMA are evaluated and the results proved that uniRDMA maintains high performance close to native RDMA.
\end{itemize}
